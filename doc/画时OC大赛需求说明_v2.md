# 画时 OC PK 活动需求说明（现有功能版）

本文根据现有前端 Demo 的真实交互与数据结构，重新梳理活动需求，供产品、设计与研发对齐。

---

## 1. 活动概览

- **活动名称**：画时 OC PK 赛
- **目标用户**：原创角色创作者及社区观众
- **核心目标**：
  1. 支持创作者报名参赛并补充亮点信息；
  2. 在多轮 PK 中完成投票、查看对阵、分享 PK 号码；
  3. 展示最终榜单并完成中奖用户的邮寄信息收集；
  4. 通过投票进度驱动抽奖，提升参与粘性。
- **数据说明**：当前 Demo 使用 `src/data/mockData.ts` 中的静态数据，所有接口、中奖逻辑均为本地模拟。

---

## 2. 活动阶段与视图规则

| 阶段 | Stage Key | 默认视图 | 可访问视图 | 说明 |
| --- | --- | --- | --- | --- |
| 报名期 | `registration` | 首页 | 首页（home）、报名入口（register 按钮触发弹窗） | 仅开放报名相关能力。 |
| 评选期 | `evaluation-32` / `evaluation-8` | PK 列表 | 首页、PK 投票、我的参赛、PK 列表、抽奖 | 对阵列表、投票与抽奖可用，报名入口关闭。 |
| 公示期 | `announcement` | 最终榜单 | 首页、我的参赛、最终榜单、抽奖 | 投票相关入口关闭，自动弹出邮寄信息。 |

- **阶段切换**：通过 URL 查询参数 `?stage=索引`（0=报名、1=32进16、2=8进4、3=公示）模拟活动所处阶段。浏览器回退监听 `popstate` 与参数同步。
- **视图守卫**：当阶段变更导致当前视图不可访问时，自动回退到该阶段的默认视图。
- **导航顺序**：顶部导航固定顺序 `home → register → vote → myEntries → pkList → leaderboard → lottery`，根据阶段隐藏不符合条件的入口。

---

## 3. 全局布局与通用元素

- **头部**：显示活动名称、副标题以及登录用户信息（昵称、头像、获奖标记）。
- **顶部导航**：按钮样式导航，当前视图高亮。禁用项不可点击。
- **PK 号码直达**：
  - 在评选期且当前视图不是投票页时，于导航下方显示 `PkNumberSearch` 输入框，可跳转到指定 PK 并切换到投票视图。
  - 投票页内保留同组件，便于在投票过程中直接跳转其它对阵。
- **底部声明**：固定提示“所有数据为演示模拟”。
- **弹窗蒙层**：报名、抽奖结果、邮寄信息均使用统一的 `modal-mask` 蒙层样式。

---

## 4. 功能模块详述

### 4.1 活动首页（ActivityHome）
- **动态标题**：根据阶段展示阶段文案（报名中 / PK 进行中 / 榜单揭晓）。
- **报名期内容**：
  - 活动亮点、奖品池列表。
  - 报名人数统计与“立即报名”按钮（触发报名弹窗）。
- **评选期内容**：
  - 当前轮次、总组数、已完成组数、剩余时间信息卡片。
  - CTA 按钮进入投票页或抽奖页。
- **公示期内容**：
  - 展示前四名作品摘要（含名次与奖项标签）。
  - CTA 按钮进入“我的参赛”与“抽奖记录”。

### 4.2 报名入口（RegistrationForm 模块弹窗）
- **触发条件**：仅在报名期通过首页按钮手动打开，也可再次关闭。
- **作品列表**：展示用户可报名的 OC 作品（图、作者、标签、简介），支持多选。
- **补充信息**：对已选作品填写参赛标题与亮点说明。
- **报名提交**：点击“确认报名”后生成报名链接列表，并展示在“报名成功”侧栏。
- **分享能力**：每条报名链接提供复制按钮；复制成功 2 秒内显示“已复制”反馈。

### 4.3 PK 投票页（VotingArena）
- **头部信息**：当前轮次、PK 号码、截止时间、整体进度（已完场数 / 总场数）、阶段剩余时间。
- **作品展示**：
  - 左右两侧对阵卡片，标题、作者、亮点文案。
  - `WorkGallery` 组件支持多图切换、缩略图选择；无图时展示占位文案。
  - 预留“查看作品详情”按钮（目前为静态按钮）。
- **实时票况**：
  - 中部投票进度条展示双方票数、比例及领先方描述。
  - 票数取自接口基础票数 + 本地投票结果（无后端校验）。
- **投票操作**：
  - 底部按钮“投左 / 换一组 / 投右”；换一组随机挑选进行中的其它 PK。
  - 首票免费提示、累计投票与抽奖进度文案动态变化。
- **抽奖进度**：每投 10 票获得 1 次抽奖机会，文案实时反馈剩余票数或新增次数。

### 4.4 我的参赛（MyEntriesBoard）
- 展示用户全部参赛作品卡片，内容包含：封面、当前状态（进行中/晋级/淘汰/轮空）、当前轮次、对手信息、裁决说明。
- 提供“直达对阵 / 复制 PK 号码 / 分享”操作按钮（静态按钮）。
- 状态颜色区分四种状态便于快速识别。

### 4.5 PK 列表（PkListTable）
- **头部元信息**：当前轮次、完成进度条、剩余时间。
- **展示模式**：
  - 当存在 8 进 4 / 4 进 2 / 冠军战轮次时，启用 **淘汰赛树状视图**；根据轮次层级计算纵向位移与连线间距。
  - 其他情况下退化为表格列表，显示 PK 号、左右作品摘要、投票进度。
- **交互**：点击任意对阵卡片或表格行跳转到对应 PK，并切换到投票视图。
- **冠军卡片**：若冠军战已结束，突出显示冠军作品及票数；否则显示“等待揭晓”。

### 4.6 最终榜单（LeaderboardWall）
- 展示前 8 名作品，Top3 使用领奖台布局（含奖项徽章），其余作品栅格排列。
- 公示期内提示“榜单公示中”；评选期提前查看时提供“生成获奖证书”按钮（静态）。

### 4.7 抽奖中心（LotteryPanel）
- **入口条件**：视图仅在评选期 / 公示期开放，是否可抽取由 `config.isUnlocked` 控制。
- **剩余次数**：显示剩余抽奖次数，次数为 0 时点击按钮给出“再投 10 票可获得 1 次”反馈。
- **奖池展示**：按配置列表展示奖品图片、名称、概率。
- **抽奖记录**：侧栏列表倒序记录本地抽奖历史。
- **弹窗反馈**：成功抽取后展示奖品图片与名称的结果弹窗，点击“知道了”关闭。
- **提示机制**：抽奖按钮旁显示最近一次提示文案（自动 2.4 秒消失）。

### 4.8 邮寄信息弹窗（ShippingModal）
- **触发条件**：
  - 当前阶段为公示期；
  - 用户为获奖者（`userProfile.isWinner = true`）；
  - 未提交过邮寄信息。
- **表单字段**：收件人、联系电话、收件地址均为必填。
- **成功后处理**：关闭弹窗并在页面底部显示“邮寄信息已提交”浮条，列出姓名、电话、地址。
- **文案**：根据获奖作品名称与奖项动态生成祝贺语。

---

## 5. 数据依赖与可配置项

- **作品信息**：`OC_WORKS` 提供报名、投票、榜单等模块所需的作品元数据。
- **赛程配置**：`MATCHES_BY_STAGE` 区分 32 强与 8 强两个阶段的对阵数据，公示期沿用 8 强数据。
- **活动元信息**：`ACTIVITY_META_BY_STAGE` 提供各阶段的轮次标题、总组数、剩余时间文本。
- **报名统计**：`REGISTRATION_CONFIG` 包含报名人数、奖励、规则文案。
- **我的参赛**：`MY_ENTRIES` 用于“我的参赛”模块卡片内容。
- **榜单数据**：`LEADERBOARD` 定义最终排名与奖项归属。
- **抽奖配置**：`LOTTERY_CONFIG` 控制抽奖入口是否解锁、剩余次数、奖品池与历史记录。

---

## 6. 待接入/待拓展点

1. **数据接口化**：当前所有数据存于前端静态文件，需要按模块拆分 API（报名列表、对阵列表、投票计数、抽奖记录等）。
2. **操作联动**：投票、抽奖、报名、复制等交互仅有前端态，需要补齐后端校验与埋点。
3. **分享与详情页**：按钮占位未落地，需设计分享卡、作品详情页及路由。
4. **账号体系**：示例用户写死在前端，后续需结合登录态与权限。
5. **阶段调度**：目前通过 URL 参数手动切换，正式环境需根据服务端活动配置驱动。

---

本说明覆盖 Demo 中已实现的全部可见功能，可作为后续产品与开发迭代的基线文档。
